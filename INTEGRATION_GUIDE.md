# üîó –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

## ‚úÖ –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ

–°–∏—Å—Ç–µ–º–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞! –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç:

- ‚úÖ **MongoDB —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—Ü–µ–Ω–∞, –∫–æ–º–Ω–∞—Ç—ã, –≥–æ—Ä–æ–¥)
- ‚úÖ **–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î Chroma** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—è–º
- ‚úÖ **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫** - –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –æ–±–∞ –ø–æ–¥—Ö–æ–¥–∞
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π pipeline** - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –æ–±–µ –ë–î –ø—Ä–∏ —Å–∫—Ä–∞–ø–∏–Ω–≥–µ
- ‚úÖ **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã

---

## üöÄ –®–∞–≥–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å OpenAI API –∫–ª—é—á

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [platform.openai.com](https://platform.openai.com)
2. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –≤ —Ä–∞–∑–¥–µ–ª–µ "API Keys"
3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
OPENAI_API_KEY=–≤–∞—à_api_–∫–ª—é—á_–∑–¥–µ—Å—å
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∞–ø–∏–Ω–≥ –∫–æ–¥

–í —Ñ–∞–π–ª–µ `scarpy.py` –∑–∞–º–µ–Ω–∏—Ç–µ pipeline:

```python
# –°—Ç–∞—Ä–æ–µ
custom_settings = {
    'ITEM_PIPELINES': {'__main__.MongoDBPipeline': 1}
}

# –ù–æ–≤–æ–µ  
custom_settings = {
    'ITEM_PIPELINES': {'hybrid_pipeline.HybridMongoDBPipeline': 1}
}
```

### –®–∞–≥ 3: –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î

```bash
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ–º–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏
python real_estate_vector_db.py --populate

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
python real_estate_vector_db.py --stats
```

### –®–∞–≥ 4: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ API

–í `main.py` –∏–ª–∏ `app.py` –¥–æ–±–∞–≤—å—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç:

```python
from hybrid_search import HybridRealEstateSearch

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
search_engine = HybridRealEstateSearch()

@app.post("/search")
async def search_listings(request: SearchRequest):
    """–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏"""
    results = search_engine.search(
        filters={
            "city": request.city,
            "rooms": request.rooms,
            "max_price": request.max_price,
            "building_type": request.building_type
        },
        semantic_query=request.description_query,
        listing_type=request.listing_type,
        limit=request.limit or 20
    )
    return {"results": results, "count": len(results)}
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –¢–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä—ã (–∫–∞–∫ —Å–µ–π—á–∞—Å)
```python
results = search_engine.search(
    filters={"city": "Gda≈Ñsk", "rooms": 2, "max_price": 4000},
    listing_type="rent"
)
```

### 2. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
```python
results = search_engine.search(
    semantic_query="—Ç–∏—Ö–∏–π —Ä–∞–π–æ–Ω —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π –∏ –±–∞–ª–∫–æ–Ω–æ–º",
    listing_type="rent"
)
```

### 3. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç!)
```python
results = search_engine.search(
    filters={"city": "Gda≈Ñsk", "max_price": 4000},
    semantic_query="—Å–µ–º–µ–π–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ —Ç–∏—Ö–æ–º —Ä–∞–π–æ–Ω–µ",
    listing_type="rent"
)
```

---

## üîß –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### ID –∫–∞–∫ –∫–ª—é—á —Å–≤—è–∑–∏
- **MongoDB**: `{"_id": "ID4xP4D", "title": "...", "description": "..."}`
- **Chroma**: `{"id": "ID4xP4D", "vector": [...], "metadata": {...}}`

### Workflow –ø–æ–∏—Å–∫–∞
1. **MongoDB** —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º ‚Üí –ø–æ–ª—É—á–∞–µ–º ID —Å–ø–∏—Å–æ–∫
2. **Chroma** –∏—â–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Å—Ä–µ–¥–∏ —ç—Ç–∏—Ö ID ‚Üí –ø–æ–ª—É—á–∞–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ ID
3. **MongoDB** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º ID

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- üöÄ **–ë—ã—Å—Ç—Ä–æ**: MongoDB –∏–Ω–¥–µ–∫—Å—ã + –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
- üéØ **–¢–æ—á–Ω–æ**: —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ + —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã  
- üîÑ **–ì–∏–±–∫–æ**: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ç–∏–ø –ø–æ–∏—Å–∫–∞

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- **MongoDB —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: ~10-50ms
- **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫**: ~100-300ms  
- **–ü–æ–ª–Ω—ã–π –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫**: ~200-400ms

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
```javascript
// –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –≤ MongoDB
db.rent_listings.createIndex({"city": 1, "room_count": 1, "price": 1})
db.sale_listings.createIndex({"city": 1, "room_count": 1, "price": 1})
```

---

## üõ†Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã:
```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î
python real_estate_vector_db.py --stats

# –î–µ–º–æ –ø–æ–∏—Å–∫–∞ (–±–µ–∑ OpenAI)
python demo_hybrid_system.py

# –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (—Å OpenAI)
python real_estate_vector_db.py --search "—Ç–∏—Ö–∏–π —Ä–∞–π–æ–Ω —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π"

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
python hybrid_search.py
```

---

## üì± –ü—Ä–∏–º–µ—Ä –¥–ª—è WhatsApp –±–æ—Ç–∞

```python
def handle_search_message(message_text, user_filters):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤ WhatsApp –±–æ—Ç–µ"""
    
    # –ü–∞—Ä—Å–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    semantic_query = extract_semantic_query(message_text)
    filters = parse_user_filters(user_filters)
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
    results = search_engine.search(
        filters=filters,
        semantic_query=semantic_query,
        listing_type="rent",  # –∏–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        limit=5  # –¥–ª—è WhatsApp –ª—É—á—à–µ –º–µ–Ω—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    )
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
    if results:
        response = f"üè† –ù–∞–π–¥–µ–Ω–æ {len(results)} –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π:\n\n"
        for i, listing in enumerate(results[:3], 1):
            response += f"{i}. {listing['title']}\n"
            response += f"üí∞ {listing['price']} z≈Ç\n"
            response += f"üìç {listing['city']}, {listing.get('district', '')}\n"
            response += f"üè† {listing['room_count']} –∫–æ–º–Ω., {listing['space_sm']} –º¬≤\n\n"
    else:
        response = "üòî –ù–µ –Ω–∞–π–¥–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ –≤–∞—à–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º"
    
    return response
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤–∞—à –±–æ—Ç —Å–º–æ–∂–µ—Ç:

1. **–ü–æ–Ω–∏–º–∞—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫**: "–Ω–∞–π–¥–∏ —Ç–∏—Ö—É—é 2-–∫–æ–º–Ω–∞—Ç–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ –ì–¥–∞–Ω—å—Å–∫–µ —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π"
2. **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã**: —Ü–µ–Ω–∞ + —Å–µ–º–∞–Ω—Ç–∏–∫–∞ + –ª–æ–∫–∞—Ü–∏—è
3. **–†–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏**: —Å–∞–º—ã–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–≤—ã–º–∏
4. **–†–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–æ**: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
- ‚ùå –°—Ç–∞—Ä–æ–µ: "2 –∫–æ–º–Ω–∞—Ç—ã Gdansk –¥–æ 4000" ‚Üí —Ç–æ–ª—å–∫–æ —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
- ‚úÖ –ù–æ–≤–æ–µ: "—Å–µ–º–µ–π–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ —Ç–∏—Ö–æ–º —Ä–∞–π–æ–Ω–µ –ì–¥–∞–Ω—å—Å–∫–∞ —Å –ø–∞—Ä–∫–æ–≤–∫–æ–π –¥–æ 4000 –∑–ª" ‚Üí —É–º–Ω—ã–π –ø–æ–∏—Å–∫!

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ



